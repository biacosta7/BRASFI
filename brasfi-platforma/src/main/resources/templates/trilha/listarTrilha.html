<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Trilhas de Conhecimento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" th:href="@{/css/time-picker.css}" />
    <link rel="stylesheet" th:href="@{/css/eixo-picker.css}" />
    <style>
        /* General Modal Overlay */
        .custom-modal-overlay {
            position: fixed; /* Stays in place relative to the viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black background */
            display: flex; /* Use flexbox for centering */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            z-index: 1050; /* Ensure it's on top of most other content */
            overflow-y: auto; /* Allow scrolling if content is too tall */
        }

        /* Class to hide the modal */
        .custom-modal-overlay.hidden {
            display: none;
        }

        /* Modal Content Box */
        .custom-modal-content {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            max-width: 500px; /* Max width for the modal */
            width: 90%; /* Responsive width */
            padding: 20px;
            position: relative; /* For potential absolute positioning of inner elements */
            box-sizing: border-box; /* Include padding in width/height */
        }

        /* Modal Body Section */
        .custom-modal-body {
            padding: 15px 0; /* Add some vertical padding */
        }

        /* Modal Footer Section (for buttons) */
        .custom-modal-footer {
            display: flex;
            justify-content: center; /* Center buttons horizontally */
            gap: 10px; /* Space between buttons */
            padding-top: 15px; /* Space above buttons */
            border-top: 1px solid #eee; /* Light line above buttons */
            margin-top: 20px; /* Space above the border */
        }

    </style>
</head>
<body class="bg-gray-100">

<div class="flex h-screen">
    <aside class="w-60 bg-gray-200 p-6 flex flex-col gap-6">
        <div class="text-xl font-bold">BRASFI conecta</div>
        <nav class="flex flex-col gap-4">
            <button class="text-left text-lg font-medium">Dashboard</button>
            <button class="text-left text-lg font-medium">Trilhas</button>
            <button class="text-left text-lg font-medium">Grupos</button>
            <button class="text-left text-lg font-medium">Projetos</button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="bg-white p-4 shadow-sm flex items-center justify-between gap-4">
            <div class="relative flex-grow max-w-2xl"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" placeholder="Pesquisar na plataforma..." class="border border-gray-300 rounded-full px-4 py-2 pl-10 w-full text-sm focus:outline-none focus:ring-1 focus:ring-gray-300"/>
            </div>
            <div class="flex items-center gap-4">
                <button class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9.562M14.857 17.082a23.848 23.848 0 0 1-5.454-1.31m5.454 1.31A9.065 9.065 0 0 1 18 18.75a9 9 0 0 1-7.026 1.809c-.729 0-1.44-.194-2.07-.523M11.522 17.567a9.065 9.065 0 0 1-7.026-1.809A9 9 0 0 1 3 9.75c0-6.185 4.755-11.233 10.125-11.691m0 0l-1.428-.73M13.5 4.65V4.5m-3.328 1.487a23.847 23.847 0 0 0 5.454-1.31m-5.454 1.31A9.065 9.065 0 0 0 6 5.25c-6.185 0-11.233 4.755-11.691 10.125M12 16.5v-.22M21 12a9 9 0 0 0-9-9"></path>
                    </svg>
                </button>
                <img src="https://via.placeholder.com/40" alt="User Avatar" class="rounded-full w-10 h-10">
                <div>
                    <span class="font-semibold text-gray-800">Murilo</span>
                    <span class="text-sm text-gray-500 block">Admin</span>
                </div>
            </div>
        </header>

        <div class="p-6 flex-grow">
            <h1 class="text-3xl font-bold mb-6">Trilhas de conhecimento</h1>

            <div class="flex gap-3 mb-6">
                <button class="bg-gray-300 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-400 transition-colors">Todos</button>
                <button class="bg-gray-200 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors">Liderança</button>
                <button class="bg-gray-200 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors">Finanças</button>
                <button class="bg-gray-200 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors">Empreendedorismo</button>
                <button class="bg-gray-200 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors">Salvos</button>
            </div>

            <div th:if="${cargoUsuario == 'ADMINISTRADOR'}" class="flex gap-3 justify-end mb-6">
                <button id=""
                        class="rounded-md bg-[#65A603] text-white px-4 py-2 hover:bg-green-700 flex items-center justify-center transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Adicionar aula
                </button>

                <button id="openNewTrilhaModalBtn"
                        class="rounded-md bg-[#18290C] text-white px-4 py-2 hover:bg-gray-800 flex items-center justify-center transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Criar Trilha
                </button>
            </div>

            <div class="flex gap-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full lg:w-3/4">

                    <div th:each="trilha : ${trilhas}" class="bg-white p-4 rounded-xl shadow-md relative">
                        <div th:style="'background-image: url(' + ${trilha.capa ?: 'https://via.placeholder.com/150'} + ')'"
                             class="h-32 bg-gray-200 rounded-lg mb-4 bg-cover bg-center"></div>

                        <div class="flex justify-between items-center mb-2">
                            <span th:text="${trilha.eixoTematico != null ? trilha.eixoTematico.displayValue : 'N/A'}"
                                  th:style="${trilha.eixoTematico == 'EMPREENDEDORISMO' ? 'background-color: #FFD700; color: #333;' : (trilha.eixoTematico == 'FINANCAS' ? 'background-color: #ADD8E6; color: #333;' : (trilha.eixoTematico == 'LIDERANCA' ? 'background-color: #90EE90; color: #333;' : 'background-color: #e0e0e0; color: #555;'))}"
                                  class="text-xs px-3 py-1 rounded-full font-semibold"></span>
                            <div class="flex items-center text-yellow-500 text-sm">★★★★☆<span class="text-xs text-gray-500 ml-1">(123)</span></div>
                        </div>

                        <div class="flex justify-between items-center relative mb-1">
                            <h2 th:text="${trilha.titulo}" class="font-semibold text-base flex-grow pr-2"></h2>
                            <div class="relative">
                                <button th:id="'kebab-menu-btn-' + ${trilha.id}"
                                        class="text-gray-500 hover:text-gray-800 px-2 py-1 rounded-full transition-colors"
                                        onclick="toggleKebabMenu(this, event)">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
                                    </svg>
                                </button>
                                <div th:id="'kebab-menu-' + ${trilha.id}"
                                     class="absolute right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-md hidden z-10 w-32 overflow-hidden">
                                    <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
                                            th:data-trilha-id="${trilha.id}"
                                            th:data-trilha-titulo="${trilha.titulo}"
                                            th:data-trilha-descricao="${trilha.descricao}"
                                            th:data-trilha-eixo="${trilha.eixoTematico}"
                                            th:data-trilha-duracao="${duracaoInput}"
                                            th:data-trilha-topicos="${trilha.topicosDeAprendizado}"
                                            onclick="openEditTrilhaModal(this)">
                                        Editar
                                    </button>
                                    <button class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-100 transition-colors"
                                            th:data-trilha-id="${trilha.id}"
                                            th:data-trilha-titulo="${trilha.titulo}"
                                            onclick="abrirDeletarModal(this.dataset.trilhaId, this.dataset.trilhaTitulo)">
                                        Deletar
                                    </button>
                                </div>
                            </div>
                        </div>

                        <p th:text="${trilha.descricao}" class="text-sm text-gray-600"></p>
                    </div>

                </div>

                <aside class="w-1/4 bg-white p-4 rounded-lg shadow h-fit hidden lg:block">
                    <h3 class="font-semibold mb-4">Sugestões:</h3>
                    <div class="mb-3">
                        <p class="text-sm text-gray-500">Aula 01: Nome da aula</p>
                        <p class="text-xs text-gray-400">Nome do curso</p>
                        <a href="#" class="text-blue-600 text-xs">Acessar ></a>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Aula 02: Por que Sustentabilidade Importa?</p>
                        <p class="text-xs text-gray-400">Introdução à Finanças Sustentáveis</p>
                        <a href="#" class="text-blue-600 text-xs">Acessar ></a>
                    </div>
                </aside>
            </div>
        </div>
    </main>
</div>

<div id="newTrilhaModalContainer"></div>
<div id="editTrilhaModalContainer"></div>
<div id="deleteTrilhaModalContainer"></div>

<script>
    // Function to toggle the kebab menu visibility
    function toggleKebabMenu(buttonElement, event) {
        event.stopPropagation(); // Crucial: Prevents the document click listener from immediately closing the menu

        const trilhaId = buttonElement.id.replace('kebab-menu-btn-', '');
        const menuDiv = document.getElementById('kebab-menu-' + trilhaId);

        // Close all other open kebab menus EXCEPT the one being toggled
        document.querySelectorAll('[id^="kebab-menu-"]').forEach(menu => {
            if (menu.id !== 'kebab-menu-' + trilhaId && !menu.classList.contains('hidden')) {
                menu.classList.add('hidden');
            }
        });

        if (menuDiv) {
            menuDiv.classList.toggle('hidden');
        }
    }

    // Function to close kebab menus when clicking outside
    function closeKebabMenusOutside(event) {
        // Iterate through all kebab menus
        document.querySelectorAll('[id^="kebab-menu-"]').forEach(menu => {
            const buttonId = 'kebab-menu-btn-' + menu.id.replace('kebab-menu-', '');
            const button = document.getElementById(buttonId);

            // Check if the clicked element is *not* the menu, and *not* the button that controls this menu
            if (menu && button && !menu.classList.contains('hidden') && !menu.contains(event.target) && !button.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });
    }

    // Add the global click listener once when the DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        document.addEventListener('click', closeKebabMenusOutside);
    });
</script>
<script th:src="@{/js/criar-trilha.js}"></script>
<script th:src="@{/js/deletar-trilha.js}"></script>
<script th:src="@{/js/editar-trilha.js}"></script>
<script th:src="@{/js/eixo-picker.js}"></script>
<script th:src="@{/js/time-picker.js}"></script>

</body>
</html>