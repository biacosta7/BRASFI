<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Adicionar Aula</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para o ícone de reprodução dentro da pré-visualização */
        .video-preview-placeholder::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 48px; /* Ícone de reprodução maior */
            height: 48px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .video-preview-placeholder {
            position: relative;
            background-color: #e0e0e0; /* Um fundo cinza claro para o placeholder */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 1.25rem;
        }

        .video-preview-placeholder.has-video {
            background-color: transparent;
        }

        .custom-file-input {
            display: none; /* Garante que o input original esteja oculto */
        }

        /* Se você tem estilos mais amplos que afetam inputs de arquivo, pode ser necessário sobreescrevê-los */
        input[type="file"]::-webkit-file-upload-button {
            display: none;
        }
        input[type="file"]::file-selector-button {
            display: none;
        }


    </style>
</head>
<body class="p-8">

<!-- Botão para abrir o modal -->
<button onclick="showAddAulaModal()"
        class="px-6 py-3 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
    Abrir Modal de Adicionar Aula
</button>

<!-- O modal está inicialmente escondido com a classe 'hidden' -->
<div id="modalRegistrarTrilha" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <!-- Removida a classe max-h-[80vh] para permitir que o modal se ajuste à altura do conteúdo -->
    <div class="bg-white w-full max-w-xl min-w-[980px] mx-auto rounded-lg shadow-lg relative flex flex-col p-8">
        <!-- O título e o input de nome da aula estão agora na mesma seção p-8 -->
        <h2 class="text-4xl font-semibold mb-6">Adicionar Aula</h2>

        <!-- Removida a classe overflow-y-auto para evitar o scroll interno -->
        <div class="p-0 flex-grow">
            <form th:action="@{/aulas/salvar}" th:object="${aula}" method="post" enctype="multipart/form-data">
                <div class="mb-6">
                    <div class="mb-4">
                        <!-- Placeholder ajustado -->
                        <input placeholder="Digite o nome da aula..." type="text" th:field="*{titulo}"
                               class="w-full border-b-2 border-gray-300 p-2 focus:ring-0 outline-none font-semibold text-xl" />
                    </div>
                </div>

                <!-- Alterado para grid de 2 colunas para telas grandes -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Coluna 1: Anexar link da aula -->
                    <div class="border border-[#65A603] p-4 rounded-lg flex flex-col">
                        <label for="link" class="flex text-lg items-center text-gray-700 font-medium mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-5 mr-1" viewBox="0 0 20 21" fill="none">
                                <path d="M10.0811 19.2147C15.0091 19.2147 19.004 15.2198 19.004 10.2918C19.004 5.36379 15.0091 1.36887 10.0811 1.36887C5.15312 1.36887 1.1582 5.36379 1.1582 10.2918C1.1582 15.2198 5.15312 19.2147 10.0811 19.2147Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8.29688 6.72261L13.6506 10.2918L8.29688 13.8609V6.72261Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Anexar link da aula
                        </label>
                        <!-- Placeholder ajustado -->
                        <input type="url" id="link" th:field="*{link}" placeholder="Copie e cole aqui..."
                               class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 mb-4">
                        <label class="text-gray-700 font-medium mb-2">Pré-visualização</label>
                        <div id="videoPreviewContainer" class="flex-grow w-full bg-gray-200 rounded-md flex items-center justify-center relative video-preview-placeholder" style="min-height: 180px;">
                        </div>
                    </div>

                    <!-- Coluna 2: Descrição e Trilha empilhadas, e Materiais de apoio abaixo -->
                    <div class="flex flex-col gap-6">
                        <!-- Descrição e Trilha (lado a lado) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="border border-[#65A603] p-4 rounded-lg flex flex-col">
                                <label for="descricao" class="flex text-lg items-center text-gray-700 font-medium mb-2">

                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-600" viewBox="0 0 19 15" fill="none">
                                        <path d="M14.0885 13.0421H1.13379" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M17.7899 9.34073H1.13379" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14.0885 5.6394H1.13379" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M17.7899 1.93802H1.13379" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Descrição
                                </label>
                                <textarea id="descricao" th:field="*{descricao}" rows="5" placeholder="Lorem ipsum dolor sit amet, consectetur adipiscing elit"
                                          class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 flex-grow"></textarea>
                            </div>

                            <div class="border border-[#65A603] p-4 rounded-lg flex flex-col">
                                <label class="flex items-center text-gray-700 text-lg font-medium mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 19 19" fill="none">
                                        <path d="M15.7333 1H3.26667C2.01482 1 1 2.08731 1 3.42857V15.5714C1 16.9127 2.01482 18 3.26667 18H15.7333C16.9852 18 18 16.9127 18 15.5714V3.42857C18 2.08731 16.9852 1 15.7333 1Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M13.5647 3.95653H5.43432C4.61789 3.95653 3.95605 4.24017 3.95605 4.59007V7.75777C3.95605 8.10767 4.61789 8.39131 5.43432 8.39131H13.5647C14.3812 8.39131 15.043 8.10767 15.043 7.75777V4.59007C15.043 4.24017 14.3812 3.95653 13.5647 3.95653Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Trilha
                                </label>
                                <div class="space-y-2 flex-grow overflow-y-auto">
                                    <div th:each="trilha : ${trilhas}">
                                        <input type="checkbox" th:id="${'trilha-' + trilha.id}" name="trilhas" th:value="${trilha.id}"
                                               class="form-checkbox h-4 w-4 text-[#65A603] border-gray-300 rounded focus:ring-green-500">
                                        <label th:for="${'trilha-' + trilha.id}" th:text="${trilha.titulo}" class="ml-2 text-gray-700"></label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Materiais de apoio: agora dentro da segunda coluna, abaixo de Descrição e Trilha -->
                        <div class="border border-[#65A603] p-4 rounded-lg">
                            <div class="text-gray-700 text-lg font-medium mb-4">
                                <div class="flex items-baseline mb-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-5 mr-2" viewBox="0 0 20 21" fill="none">
                                        <path d="M18.1688 10.023L10.2942 17.8976C9.32947 18.8623 8.02105 19.4042 6.65676 19.4042C5.29247 19.4042 3.98406 18.8623 3.01936 17.8976C2.05466 16.9329 1.5127 15.6245 1.5127 14.2602C1.5127 12.8959 2.05466 11.5875 3.01936 10.6228L10.894 2.74815C11.5371 2.10502 12.4094 1.74371 13.3189 1.74371C14.2284 1.74371 15.1007 2.10502 15.7438 2.74815C16.387 3.39129 16.7483 4.26356 16.7483 5.17309C16.7483 6.08262 16.387 6.95489 15.7438 7.59803L7.86066 15.4726C7.53909 15.7942 7.10296 15.9749 6.64819 15.9749C6.19343 15.9749 5.75729 15.7942 5.43572 15.4726C5.11416 15.1511 4.9335 14.7149 4.9335 14.2602C4.9335 13.8054 5.11416 13.3693 5.43572 13.0477L12.7105 5.78147" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Materiais de apoio</span>
                                </div>

                                <p class="ml-auto text-sm text-gray-500 font-normal">Deseja anexar algum material?</p>
                            </div>

                            <div class="flex gap-3 items-baseline mb-4 pr-6">
                                <label for="linkApoio" class="block text-gray-600 text-sm font-semibold mb-1">Links</label>
                                <input type="url" name="linkApoio" placeholder="Copie e cole aqui..."
                                           class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400">
                            </div>

                            <div class="flex gap-3 items-baseline">
                                <label for="documentos" class="block text-gray-600 text-sm font-semibold mb-1">Documentos</label>

                                <input type="file" id="documentos" name="documentos" multiple class="hidden">

                                <div class="flex items-baseline mb-1 text-[#444444] hover:text-gray-800 cursor-pointer text-sm font-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-4 mr-1" viewBox="0 0 14 14" fill="none">
                                        <path d="M12.7624 8.87225V11.5161C12.7624 11.8667 12.6232 12.2029 12.3753 12.4508C12.1274 12.6987 11.7911 12.838 11.4405 12.838H2.18715C1.83655 12.838 1.50032 12.6987 1.25241 12.4508C1.00451 12.2029 0.865234 11.8667 0.865234 11.5161V8.87225" stroke="#444444" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10.1183 4.24576L6.81357 0.940979L3.50879 4.24576" stroke="#444444" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M6.81348 0.940979V8.87245" stroke="#444444" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Fazer Upload de Arquivos
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" onclick="closeAddAulaModal()"
                            class="px-10 py-2 border border-red-500 text-red-500 rounded-md font-bold hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-400">
                        Cancelar
                    </button>
                    <button type="submit"
                            class="px-10 py-2 bg-[#65A603] text-white rounded-md font-semibold hover:bg-[#65A603] focus:outline-none focus:ring-2 focus:ring-green-500">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/

    // A função closeAddAulaModal() deve referenciar 'modalRegistrarTrilha'
    function closeAddAulaModal() {
        document.getElementById('modalRegistrarTrilha').classList.add('hidden');
        resetForm(); // Opcional: redefinir o formulário ao fechar
    }

    // A função showAddAulaModal() deve referenciar 'modalRegistrarTrilha'
    function showAddAulaModal() {
        document.getElementById('modalRegistrarTrilha').classList.remove('hidden');
    }

    // Opcional: Função para redefinir o formulário (limpar inputs)
    function resetForm() {
        const form = document.querySelector('#modalRegistrarTrilha form');
        if (form) {
            form.reset();
            // Limpar pré-visualização de vídeo
            const videoPreviewContainer = document.getElementById('videoPreviewContainer');
            videoPreviewContainer.innerHTML = '';
            videoPreviewContainer.classList.remove('has-video');
            // Redefinir campo de link para apenas um input sem o botão de adicionar
            const linkApoioContainer = document.getElementById('linkApoioContainer');
            const initialLinkField = `
                <div class="flex">
                    <input type="url" name="linkApoio" placeholder="Copie e cole aqui..."
                           class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400">
                </div>
            `;
            linkApoioContainer.innerHTML = initialLinkField;
            // Redefinir exibição do input de arquivo
            document.getElementById('documentos').classList.remove('file-chosen');
        }
    }

    // Lidar com a pré-visualização de vídeo do YouTube
    document.getElementById('link').addEventListener('input', function() {
        const url = this.value;
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        videoPreviewContainer.innerHTML = ''; // Limpar conteúdo anterior
        videoPreviewContainer.classList.remove('has-video');

        let videoId = '';
        // Ajustes para as URLs do YouTube para usar a URL correta do YouTube
        // Nota: As URLs de exemplo no código original (googleusercontent.com/youtube.com/...)
        // não são URLs reais do YouTube. Para um funcionamento real, você precisaria
        // ajustar isso para padrões de URL do YouTube como "youtube.com/watch?v=" ou "youtu.be/".
        // Mantive o padrão original para compatibilidade com seu código existente,
        // mas é importante estar ciente.
        if (url.includes('youtube.com/watch?v=')) {
            videoId = url.split('v=')[1].split('&')[0];
        } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1].split('?')[0];
        } else if (url.includes('youtube.com/embed/')) { // Para links já incorporados
            videoId = url.split('youtube.com/embed/')[1].split('?')[0];
        } else if (url.includes('youtube.com/live/')) { // Para transmissões ao vivo
            videoId = url.split('youtube.com/live/')[1].split('?')[0];
        }


        if (videoId) {
            const iframe = document.createElement('iframe');
            iframe.setAttribute('width', '100%');
            iframe.setAttribute('height', '100%');
            // Usando a URL de incorporação padrão do YouTube
            iframe.setAttribute('src', `https://www.youtube.com/embed/${videoId}`);
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
            iframe.setAttribute('allowfullscreen', '');
            videoPreviewContainer.appendChild(iframe);
            videoPreviewContainer.classList.add('has-video');
        }
    });

    // Função addLinkField removida, pois o protótipo não mostra um botão explícito de '+'
    // Se a funcionalidade for necessária, ela deve ser redesenhada para corresponder ao protótipo

    // Função removeLinkField não é mais diretamente usada se addLinkField for removida

    // Atualizar o visual do input de arquivo na mudança
    document.getElementById('documentos').addEventListener('change', function() {
        if (this.files && this.files.length > 0) {
            this.classList.add('file-chosen');
        } else {
            this.classList.remove('file-chosen');
        }
    });

    // Opcional: Chamar showAddAulaModal() para fins de teste
    // Em uma aplicação real, isso seria acionado por um botão na sua página principal.
    document.addEventListener('DOMContentLoaded', () => {
        // Exemplo: O modal não é mais mostrado automaticamente no carregamento da página.
        // Apenas o botão o abrirá.
    });

    /*]]>*/
</script>

</body>
</html>
