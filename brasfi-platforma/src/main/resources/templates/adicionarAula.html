<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Aula</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Custom styles for the play icon within the preview */
        .video-preview-placeholder::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 48px; /* Larger play icon */
            height: 48px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .video-preview-placeholder {
            position: relative;
            background-color: #e0e0e0; /* A light grey background for the placeholder */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 1.25rem;
        }

        .video-preview-placeholder.has-video {
            background-color: transparent;
        }

        /* Hide default file input button */
        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
        }
        .custom-file-input::before {
            content: 'Fazer Upload de Arquivos';
            display: inline-block;
            background: #e2e8f0; /* bg-gray-200 */
            border: 1px solid #cbd5e0; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 1rem;
            outline: none;
            white-space: nowrap;
            -webkit-user-select: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            color: #4a5568; /* text-gray-700 */
        }
        .custom-file-input:hover::before {
            background: #edf2f7; /* bg-gray-100 */
        }
        .custom-file-input:active::before {
            background: #e2e8f0; /* bg-gray-200 */
        }
        .custom-file-input.file-chosen::before {
            content: 'Arquivo(s) Selecionado(s)';
            background: #d1fae5; /* bg-green-100 */
            border-color: #34d399; /* border-green-500 */
            color: #065f46; /* text-green-800 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div id="addAulaModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 ">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">Adicionar Aula</h2>

        <form th:action="@{/aulas/salvar}" th:object="${aula}" method="post" enctype="multipart/form-data">
            <div class="mb-6">
                <input type="text" id="titulo" th:field="*{titulo}" placeholder="Digite o nome da aula..."
                       class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg" required>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                <div class="border border-green-400 p-4 rounded-lg flex flex-col">
                    <label for="link" class="flex items-center text-gray-700 font-medium mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 010-2.828z" clip-rule="evenodd" />
                        </svg>
                        Anexar link da aula
                    </label>
                    <input type="url" id="link" th:field="*{link}" placeholder="https://www.youtube.com/live/IJPqg7sow..."
                           class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 mb-4">
                    <div id="videoPreviewContainer" class="flex-grow w-full bg-gray-200 rounded-md flex items-center justify-center relative video-preview-placeholder" style="min-height: 180px;">
                    </div>
                </div>

                <div class="border border-gray-300 p-4 rounded-lg flex flex-col">
                    <label for="descricao" class="flex items-center text-gray-700 font-medium mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm12 10H4V6h12v8zm-3-5a1 1 0 00-1 1v2a1 1 0 102 0v-2a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        Descrição
                    </label>
                    <textarea id="descricao" th:field="*{descricao}" rows="5" placeholder="Lorem ipsum dolor sit amet, consectetur adipiscing elit"
                              class="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 flex-grow"></textarea>
                </div>

                <div class="border border-green-400 p-4 rounded-lg flex flex-col">
                    <label class="flex items-center text-gray-700 font-medium mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7z" />
                            <path fill-rule="evenodd" d="M18 8H2V6a2 2 0 012-2h12a2 2 0 012 2v2zm1 4V9H1v3a2 2 0 002 2h14a2 2 0 002-2zm-2 4H3a2 2 0 00-2 2v1a1 1 0 102 0v-1h14v1a1 1 0 102 0v-1a2 2 0 00-2-2z" clip-rule="evenodd" />
                        </svg>
                        Trilha
                    </label>
                    <div class="space-y-2 flex-grow overflow-y-auto">
                        <div th:each="trilha : ${trilhas}">
                            <input type="checkbox" th:id="${'trilha-' + trilha.id}" name="trilhas" th:value="${trilha.id}"
                                   class="form-checkbox h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                            <label th:for="${'trilha-' + trilha.id}" th:text="${trilha.titulo}" class="ml-2 text-gray-700"></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border border-blue-400 p-4 rounded-lg mb-6">
                <label class="flex items-center text-gray-700 font-medium mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd" />
                    </svg>
                    Materiais de apoio
                    <span class="ml-auto text-sm text-gray-500 font-normal">Deseja anexar algum material?</span>
                </label>

                <div class="mb-4">
                    <label for="linkApoio" class="block text-gray-600 text-sm font-medium mb-1">Links</label>
                    <div id="linkApoioContainer" class="space-y-2">
                        <div class="flex">
                            <input type="url" name="linkApoio" placeholder="www.exempl..."
                                   class="w-full p-2 border border-gray-300 rounded-l-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400">
                            <button type="button" onclick="addLinkField()" class="px-3 py-2 bg-blue-500 text-white rounded-r-md text-sm hover:bg-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <label for="documentos" class="block text-gray-600 text-sm font-medium mb-1">Documentos</label>
                    <input type="file" id="documentos" name="documentos" multiple
                           class="custom-file-input w-full block text-sm text-gray-500
                                  file:mr-4 file:py-2 file:px-4
                                  file:rounded-md file:border-0
                                  file:text-sm file:font-semibold
                                  file:bg-blue-50 file:text-blue-700
                                  hover:file:bg-blue-100">
                </div>
            </div>

            <div class="flex justify-end space-x-4 mt-8">
                <button type="button" onclick="closeAddAulaModal()"
                        class="px-6 py-3 border border-red-500 text-red-500 rounded-md font-semibold hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-400">
                    Cancelar
                </button>
                <button type="submit"
                        class="px-6 py-3 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                    Salvar
                </button>
            </div>
        </form>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/

    // Function to show the modal
    function showAddAulaModal() {
        document.getElementById('addAulaModal').classList.remove('hidden');
    }

    // Function to hide the modal
    function closeAddAulaModal() {
        document.getElementById('addAulaModal').classList.add('hidden');
        resetForm(); // Optional: reset the form when closing
    }

    // Optional: Function to reset the form (clear inputs)
    function resetForm() {
        const form = document.querySelector('#addAulaModal form');
        if (form) {
            form.reset();
            // Clear video preview
            const videoPreviewContainer = document.getElementById('videoPreviewContainer');
            videoPreviewContainer.innerHTML = '';
            videoPreviewContainer.classList.remove('has-video');
            // Remove dynamically added link fields
            const linkApoioContainer = document.getElementById('linkApoioContainer');
            const initialLinkField = `
                <div class="flex">
                    <input type="url" name="linkApoio" placeholder="www.exempl..."
                           class="w-full p-2 border border-gray-300 rounded-l-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400">
                    <button type="button" onclick="addLinkField()" class="px-3 py-2 bg-blue-500 text-white rounded-r-md text-sm hover:bg-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            `;
            linkApoioContainer.innerHTML = initialLinkField;
            // Reset file input display
            document.getElementById('documentos').classList.remove('file-chosen');
        }
    }

    // Handle YouTube video preview
    document.getElementById('link').addEventListener('input', function() {
        const url = this.value;
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        videoPreviewContainer.innerHTML = ''; // Clear previous content
        videoPreviewContainer.classList.remove('has-video');

        let videoId = '';
        if (url.includes('youtube.com/watch?v=')) {
            videoId = url.split('v=')[1].split('&')[0];
        } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1].split('?')[0];
        } else if (url.includes('youtube.com/embed/')) { // For already embedded links
            videoId = url.split('youtube.com/embed/')[1].split('?')[0];
        } else if (url.includes('youtube.com/live/')) { // For live streams
            videoId = url.split('youtube.com/live/')[1].split('?')[0];
        }


        if (videoId) {
            const iframe = document.createElement('iframe');
            iframe.setAttribute('width', '100%');
            iframe.setAttribute('height', '100%');
            iframe.setAttribute('src', `https://www.youtube.com/embed/${videoId}`);
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
            iframe.setAttribute('allowfullscreen', '');
            videoPreviewContainer.appendChild(iframe);
            videoPreviewContainer.classList.add('has-video');
        }
    });

    // Function to add new link input field
    function addLinkField() {
        const container = document.getElementById('linkApoioContainer');
        const newLinkDiv = document.createElement('div');
        newLinkDiv.className = 'flex';
        newLinkDiv.innerHTML = `
            <input type="url" name="linkApoio" placeholder="www.exempl..."
                   class="w-full p-2 border border-gray-300 rounded-l-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400">
            <button type="button" onclick="removeLinkField(this)" class="px-3 py-2 bg-red-500 text-white rounded-r-md text-sm hover:bg-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 4.293a1 1 0 011.414 0L10 8.586l3.293-3.293a1 1 0 111.414 1.414L11.414 10l3.293 3.293a1 1 0 01-1.414 1.414L10 11.414l-3.293 3.293a1 1 0 01-1.414-1.414L8.586 10 5.293 6.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        `;
        container.appendChild(newLinkDiv);
    }

    // Function to remove a link input field
    function removeLinkField(button) {
        button.parentNode.remove();
    }

    // Update file input visual on change
    document.getElementById('documentos').addEventListener('change', function() {
        if (this.files && this.files.length > 0) {
            this.classList.add('file-chosen');
        } else {
            this.classList.remove('file-chosen');
        }
    });

    // Optional: Call showAddAulaModal() for testing purposes
    // In a real application, this would be triggered by a button on your main page.
    document.addEventListener('DOMContentLoaded', () => {
        // Example: Automatically show the modal on page load for demonstration
        // showAddAulaModal();
    });

    /*]]>*/
</script>

</body>
</html>